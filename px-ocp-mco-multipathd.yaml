apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: worker-enable-multipathing
spec:
  config:
    ignition: 
      version: 3.2.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,ZGVmYXVsdHMgewoJdXNlcl9mcmllbmRseV9uYW1lcyBubwoJZW5hYmxlX2ZvcmVpZ24gIl4kIgogICAgICAgIHBvbGxpbmdfaW50ZXJ2YWwgICAgMTAKfQoKZGV2aWNlcyB7CiAgICBkZXZpY2UgewogICAgICAgIHZlbmRvciAgICAgICAgICAgICAgICAgICAgICAiTlZNRSIKICAgICAgICBwcm9kdWN0ICAgICAgICAgICAgICAgICAgICAgIlB1cmUgU3RvcmFnZSBGbGFzaEFycmF5IgogICAgICAgIHBhdGhfc2VsZWN0b3IgICAgICAgICAgICAgICAicXVldWUtbGVuZ3RoIDAiCiAgICAgICAgcGF0aF9ncm91cGluZ19wb2xpY3kgICAgICAgIGdyb3VwX2J5X3ByaW8KICAgICAgICBwcmlvICAgICAgICAgICAgICAgICAgICAgICAgYW5hCiAgICAgICAgZmFpbGJhY2sgICAgICAgICAgICAgICAgICAgIGltbWVkaWF0ZQogICAgICAgIGZhc3RfaW9fZmFpbF90bW8gICAgICAgICAgICAxMAogICAgICAgIHVzZXJfZnJpZW5kbHlfbmFtZXMgICAgICAgICBubwogICAgICAgIG5vX3BhdGhfcmV0cnkgICAgICAgICAgICAgICAwCiAgICAgICAgZmVhdHVyZXMgICAgICAgICAgICAgICAgICAgIDAKICAgICAgICBkZXZfbG9zc190bW8gICAgICAgICAgICAgICAgNjAKICAgIH0KICAgIGRldmljZSB7CiAgICAgICAgdmVuZG9yICAgICAgICAgICAgICAgICAgICJQVVJFIgogICAgICAgIHByb2R1Y3QgICAgICAgICAgICAgICAgICAiRmxhc2hBcnJheSIKICAgICAgICBwYXRoX3NlbGVjdG9yICAgICAgICAgICAgInNlcnZpY2UtdGltZSAwIgogICAgICAgIGhhcmR3YXJlX2hhbmRsZXIgICAgICAgICAiMSBhbHVhIgogICAgICAgIHBhdGhfZ3JvdXBpbmdfcG9saWN5ICAgICBncm91cF9ieV9wcmlvCiAgICAgICAgcHJpbyAgICAgICAgICAgICAgICAgICAgIGFsdWEKICAgICAgICBmYWlsYmFjayAgICAgICAgICAgICAgICAgaW1tZWRpYXRlCiAgICAgICAgcGF0aF9jaGVja2VyICAgICAgICAgICAgIHR1cgogICAgICAgIGZhc3RfaW9fZmFpbF90bW8gICAgICAgICAxMAogICAgICAgIHVzZXJfZnJpZW5kbHlfbmFtZXMgICAgICBubwogICAgICAgIG5vX3BhdGhfcmV0cnkgICAgICAgICAgICAwCiAgICAgICAgZmVhdHVyZXMgICAgICAgICAgICAgICAgIDAKICAgICAgICBkZXZfbG9zc190bW8gICAgICAgICAgICAgNjAwCiAgICB9Cn0KCmJsYWNrbGlzdF9leGNlcHRpb25zIHsKICAgICAgICBwcm9wZXJ0eSAiKFNDU0lfSURFTlRffElEX1dXTikiCn0KCmJsYWNrbGlzdCB7CiAgICAgIGRldm5vZGUgIl5weGRbMC05XSoiCiAgICAgIGRldm5vZGUgIl5weGQqIgogICAgICBkZXZpY2UgewogICAgICAgIHZlbmRvciAiVk13YXJlIgogICAgICAgIHByb2R1Y3QgIlZpcnR1YWwgZGlzayIKICAgICAgfQp9
        filesystem: root
        mode: 0644
        overwrite: true
        path: /etc/udev/rules.d/99-pure-storage.rules
      - contents:
          source: data:text/plain;charset=utf-8;base64,ZGVmYXVsdHMgewoJdXNlcl9mcmllbmRseV9uYW1lcyBubwoJZW5hYmxlX2ZvcmVpZ24gIl4kIgogICAgICAgIHBvbGxpbmdfaW50ZXJ2YWwgICAgMTAKfQoKZGV2aWNlcyB7CiAgICBkZXZpY2UgewogICAgICAgIHZlbmRvciAgICAgICAgICAgICAgICAgICAgICAiTlZNRSIKICAgICAgICBwcm9kdWN0ICAgICAgICAgICAgICAgICAgICAgIlB1cmUgU3RvcmFnZSBGbGFzaEFycmF5IgogICAgICAgIHBhdGhfc2VsZWN0b3IgICAgICAgICAgICAgICAicXVldWUtbGVuZ3RoIDAiCiAgICAgICAgcGF0aF9ncm91cGluZ19wb2xpY3kgICAgICAgIGdyb3VwX2J5X3ByaW8KICAgICAgICBwcmlvICAgICAgICAgICAgICAgICAgICAgICAgYW5hCiAgICAgICAgZmFpbGJhY2sgICAgICAgICAgICAgICAgICAgIGltbWVkaWF0ZQogICAgICAgIGZhc3RfaW9fZmFpbF90bW8gICAgICAgICAgICAxMAogICAgICAgIHVzZXJfZnJpZW5kbHlfbmFtZXMgICAgICAgICBubwogICAgICAgIG5vX3BhdGhfcmV0cnkgICAgICAgICAgICAgICAwCiAgICAgICAgZmVhdHVyZXMgICAgICAgICAgICAgICAgICAgIDAKICAgICAgICBkZXZfbG9zc190bW8gICAgICAgICAgICAgICAgNjAKICAgIH0KICAgIGRldmljZSB7CiAgICAgICAgdmVuZG9yICAgICAgICAgICAgICAgICAgICJQVVJFIgogICAgICAgIHByb2R1Y3QgICAgICAgICAgICAgICAgICAiRmxhc2hBcnJheSIKICAgICAgICBwYXRoX3NlbGVjdG9yICAgICAgICAgICAgInNlcnZpY2UtdGltZSAwIgogICAgICAgIGhhcmR3YXJlX2hhbmRsZXIgICAgICAgICAiMSBhbHVhIgogICAgICAgIHBhdGhfZ3JvdXBpbmdfcG9saWN5ICAgICBncm91cF9ieV9wcmlvCiAgICAgICAgcHJpbyAgICAgICAgICAgICAgICAgICAgIGFsdWEKICAgICAgICBmYWlsYmFjayAgICAgICAgICAgICAgICAgaW1tZWRpYXRlCiAgICAgICAgcGF0aF9jaGVja2VyICAgICAgICAgICAgIHR1cgogICAgICAgIGZhc3RfaW9fZmFpbF90bW8gICAgICAgICAxMAogICAgICAgIHVzZXJfZnJpZW5kbHlfbmFtZXMgICAgICBubwogICAgICAgIG5vX3BhdGhfcmV0cnkgICAgICAgICAgICAwCiAgICAgICAgZmVhdHVyZXMgICAgICAgICAgICAgICAgIDAKICAgICAgICBkZXZfbG9zc190bW8gICAgICAgICAgICAgNjAwCiAgICB9Cn0KCmJsYWNrbGlzdF9leGNlcHRpb25zIHsKICAgICAgICBwcm9wZXJ0eSAiKFNDU0lfSURFTlRffElEX1dXTikiCn0KCmJsYWNrbGlzdCB7CiAgICAgIGRldm5vZGUgIl5weGRbMC05XSoiCiAgICAgIGRldm5vZGUgIl5weGQqIgogICAgICBkZXZpY2UgewogICAgICAgIHZlbmRvciAiVk13YXJlIgogICAgICAgIHByb2R1Y3QgIlZpcnR1YWwgZGlzayIKICAgICAgfQp9
        mode: 0420
        overwrite: true
        path:/etc/multipath.conf
    systemd:
      units:
      - name: multipathd.service
        enabled: true
# The above manifest enabled multipathing for FiberChannel based connections. To add iSCSI based FlashArray's uncomment the two lines below to enable the iSCSI service in RHCOS.
      - name: iscsid.service
        enabled: true
        
